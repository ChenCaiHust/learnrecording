# 重构之what-why-when

在[重构的概念与节奏](learnrecording/small-cycle.md)中，其实只想要大家记住一句话：**重构的节奏是测试，小修改，测试，小修改，测试，小修改……，** 文章中也有重构的概念定义和一点点什么时候重构的内容，但不是主体，关于重构的理解其实可以用下面5个问题来引导对重构知识的学习与掌握：
* 什么是重构？（what)
* 么重构？（why) 
* 时候重构？（when) 
* 地方重构？（where)
* 何重构？（how)

本篇文章要回答的是前面三个问题，最后两个问题，由另外一篇文章来回答。

## 什么是重构？
也就是重构的定义，不然交流的东西都不是一个东西，作者对重构的定义分为名词定义及动词定义两种：
* 名词定义：对软件内部的一种调整，目的是在不改变可观察行为的前提下，提高其可理解性，降低其修改成本
* 动词定义：使用一系列重构手法，在不改变可观察行为的前提下，调整其结构

我从这两个定义中总结如下：**对重构技术的了解与掌握，本质上是学会运用重构的一系列手法，用以调整程序的结构，进而提高程序的可维护性。**

## 接下来的问题是为什么要重构？
也就是我们为什么要用重构技术来调整程序的结构呢？**当然要有实际开发的好处才行吧，我认为重构的根本目的在于能够提升软件的开发速度，为什么重构技术能够提升软件开发的速度呢？** 有下面三个原因：
* 重构改进了程序的结构，使程序的结构一直处在较健康的状态
* 重构使软件更容易理解
* 重构过程中还能找出程序的BUG

对于重构改进软件设计的理解，原文摘录如下：“如果没有重构，程序的设计就会变质。当人们只为短期目的，或者在完全理解整体设计之前，就贸然修改代码，程序将失去自己的结构，程序员越来越难通过阅读源代码而理解原来的设计。重构很像整理代码，你所做的就是让所有东西回到应处的位置上，代码结构的流失是积累性的，越难看出代码的设计意图，就越难保护其中设计，于是该设计就腐畋的越快。经常性的重构可以帮助代码维持自己该有的形态”。

如果说在过去开发实践中我们遇到最多的东西其实是两个字“重复”！有大量的重复代码，对此，不需要再详细说明重复代码的坏处，**重构改进设计的一个重要方向就是清除重复代码，如果消除重复代码，那意味着程序中所有事物和行为在代码中只表述一次，这是优秀设计的根本。**

对于重构使软件更容易的理解，其实总结出来也就一句话：**让程序准确向读者传达它在干什么！** 我们现在己经有不少的实践经验，知道没有清晰地说明它在干嘛的代码是多么地难以维护！我们要一直谨记，假如其他人来读我写的代码，他会骂我么？重构的重要目的之一就是准确让程序说出自己的目的。另外，如果代码足够整洁，可能你还会看到一些重构前不能看清楚的设计层面的东西，用作者的话来说，就是“擦掉窗户上的污垢，使你看得更远”。

重构的过程中随着对代码的理解増强，我们能够找到之前没有发现的BUG，而且随着代码整洁度的提高,调试定位BUG的速度也会加快。


## 下一个问題是什么时候重构？
基本原则是不应该专门弄出时间来进行重构，而是应该在你要做点什么其它事情的时候，重构可以帮助你把这个事情做的更快更好的时候。**如果说再具体一点的时机，那就是在添加新功能的时候进行重构，在修改错误（BUG)的时候重构，以及在代码评审的时候重构（这个现在对我们来说有点奢侈）。**

当然还有一些时间点我们不能运用重构手法，那就是：
* 在代码结构实在是太混乱，重构还不如重新写一段来得快
* 在项目快要发布的时候，请避免重构

最后总结一下本文：
* 重构是指使用一系列重构手法，在不改变可观察行为的前提下，调整其结构
* 重构在做到改进程序结构，使软件更容易理解，发现更多BUG的自然结果是能够加快软件开发的速度
* 不要专门为了重构而重构，而是在合适的软件版本迭代过程中选择好的时机点对程序进行重构
