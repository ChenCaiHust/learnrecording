# 编码规范引发的思考


最近领导分配了一个新的项目让我跟进一下，看了约10个头文件，内心就开始不爽了，具体表现在三个方面：
* 函数名称混乱，有Java风格函数的addSomething(),有C++风格函数AddSomething()，竟然还是c风格的:add_something。
* 注释混乱，前面参与这个项目的人员，不管是离职的还是在职的，都是自己怎么高兴怎么来，自成一套。
* 成员变量名称更是混乱，一会儿成员变量是m开头的，一会儿是下划线开头的……

当然，这只是粗略地看了下项目，细看起来，怎一个痛苦了得？这个场景迫使我进行了一系列思考，与有缘人共享下面的三个观点：
* 编码规范本质上是用来解决效率问题的。
* 好的代码应该像结构清晰，逻辑合理的议论文一样。
* 编码规范是领导者的重要任务之一，需要建立代码审查机制确保规范的顺利执行。

 
## 1. 编码规范本质上是用来提升软件开发及维护的效率
**软件是有生命周期的，在生命周期里面，维护软件的时间长度一般远超过纯开发时间，我把软件从0到1的过程称为开发，把从1到n的发展过程称为维护。可维护性好的软件在此本质是项目代码的可读性高，可读性高则意味着开发维护效率高，所以编码规范制定的好，执行的到位，实质上是在提升软件项目团队的效率。**

让我更多地解释下上面的观点。

试想如下的理想场景：一个软件项目团队，成员7人，在项目的整个生命周期中团队成员一直在这家公司工作，各自维护各自的模块，且基本没有出现大的影响项目的情况。


当然，你知道的，这是童话，在实际的商业生态环境下，上面场景发生的概率是极低的。现实情况是很多情况会出现：如员工离职，员工结婚，生病等，一般来说，比较严重的是员工离职这种情况出现，因为这种空缺是长期的，这时，就要有人上去接手离职同事的工作，如果团队的整体风格不一样，接手软件项目就会麻烦一些，更一步地，在项目的关键位置没有注释，没有文档，那就更可怕了，要是代码写的真的是一团糟，那只能替接手的同事表示同情了。


这就是维护工作的一部分，你不得不在软件上加东西，有时甚至不得不在别人的软件上面修改，如果是自己维护自己的东西，一般来说还好，但是如果是维护别人花了三年写的东西，且没有编码规范，文档记录等机制来保障平滑过渡，结果就是软件开发及维护效率会大大降低。


我们可能或多或少有这样的体验，接手了一个很不错的项目，里面的代码异常整洁，自己要在里面加东西，只要你不是自命清高的人，你会跟随前面的人的步伐，不愿意让自己的东西来玷污已经存在的美感，结构保持整洁，风格保持一致，基本上，这种整洁性会较长时间保持下去。


但是如果你接手的时候就是一个很烂的项目，代码给你呈现的感受就是混乱，就像文章开头描述的场景，除非万不得已，在短期内，你一般会用自己的习惯的编码方式来完成你的工作，越快完成越好，不想再多看它一眼，项目本身已经混乱，给混乱的东西再增加一种你的新风格，那结局当然是更混乱了，由此的后果想想也是知道的。


**所以，我认为团队编码风格有一个很重要的特性，我称之为一致性或者自适应性：整洁的代码一般会持续整洁下去，混乱的代码会一般也会持续混乱下去。**


如果不得不在混乱的代码上修改，那么你不得不面对恶心的混乱，你的心情不是那么愉快，说不定还带有一些小情绪，那么相当自然地，你的开发速度受影响了，更进一步，就算你很平静，但是你要用一种新的方式来理解别人写的东西，这会增加你的认知负担，你的大脑会在你习惯的工作模式与新的模式之间来回切换，这难道不会进一步降低你的效率么？


相反，如果面对的是漂亮的代码，你会高兴地继续进行下去，万一发现还有好的知识可以学习与借鉴，你还会情绪高涨，当你继续阅读代码时，你发现人家写的东西很优美简洁，基本与你习惯的方式相同，那开发或者维护效率自然不会差到哪儿去。


所以，我认为执行到位的编码规范其本质上解决的是开发和维护效率的问题。

 

## 2. 好的代码应该像一篇优美，直接，结构清晰的议论文一样


文章好不好读懂，因素很多，重要的点我认为有两个：一是表述的观点简单而直接，不拐弯抹角；二是文章的结构组织符合逻辑，不横生枝节，以此与程序代码类比的话，我认为好的编码规范必须定义好两个核心要素，良好而规范的命名，良好的程序组织结构。


让我们再展开一点点，程序里面到处都在命名，目录名，文件名，类名，函数名（方法名），变量名，如果命名控制的很规范，且描述性语义用的恰到好处，那么软件项目在可维护性上基本上有了保障，所以，命名约定是编码规范必须要解决的问题。


另外一个要点是程序的组织结构，更直白一点是代码源文件要如何组织成目录结构，源文件内的东西要如何组织成文件的问题，程序的目录结构源于程序的模块化设计，需要事先仔细考虑，进一步地需要思考单个程序文件里面的内容要如何组织，代码的注释等问题的定义，如果你想后面加入团队的成员以最快的速度熟悉你的项目的话，请特别注意程序的目录结构设计与源文件设计问题。


**当然如果要你来制定一份编码规范的话，可能都不用详细思考上面的两个问题，因为业界已经有成熟的做法了，直接拿过来做出适当的调整是最快，通常也是最好的选择。**


比如，项目里面要用C++为主语言进行编码，把Google C++编码规范拿来仔细研究参考，就能得到非常不错的C++语言规范，其它语言操作手法类似，找一个业界成熟的标准，根据标准与团队现状，适当选择调整，然后就可以成为你们团队的东西了，即快又好。


我认为制定编码规范的人要特别注意的一点是：想办法赢得团队的共识，获得最大公约数的支持，不然你弄出来的东西，没有人愿意执行或者执行阻力大，那就是纸上的东西，没有落实到代码里的规范都是空谈。

 

## 3. 编码规范的执行需要领导者负责，并建立相应代码审查机制。
编码规范的执行或者说团队编码风格的形成是软件团队领导者的责任，为了让生命更easy一点，作为领导者的你在项目团队成员不成熟的情况下，你需要做一系列的事件来保证编码规范的落地，这么聪明的你，肯定是有办法的。

我认为最好的办法是建立团队的代码审查机制，具体如何执行，需要根据团队的客观实际来操作，机制一旦建立，领导者需要做的就是维护好机制运行就行了。

编码规范在严格执行一段时间后会内化为团队的工作习惯，在团队风格养成后，在编码规范上投入的精力将是非常少的，只是在团队初期不成熟的阶段编码规范需要投入较多的精力。

 

## 4. 一点小小的建议

我觉得下面的一点是开发者需要具备的常识：认清自己的位置。下面是一些在开发场景下的含义：
* 如你离职加入一家新的公司，你的编码风格与新团队的整体风格冲突了，调整你的风格适应新公司的风格是你的工作，不要总抓住自己的东西不放。
* 如果你是代码规范的执行者，那就忠实地执行编码规范，不要打折扣，编码规范里面不需要特立独行，只需要一致性。
* 如果你是软件团队的领导者，那就要想办法让编码规范体现到代码上，这在不同的环境里面难度不尽相同，但是如果项目真的有较长生命周期，编码规范这个重要的事情你一定要放在心上。

最后，下面两本书还没有阅读的开发人员需要抓紧了：
* 《代码整洁之道》
* 《代码大全》
